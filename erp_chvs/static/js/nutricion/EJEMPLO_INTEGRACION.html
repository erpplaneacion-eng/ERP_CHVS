<!--
    EJEMPLO DE INTEGRACIÓN DE LA NUEVA ARQUITECTURA JAVASCRIPT
    
    Para usar la nueva arquitectura en templates HTML, incluir los scripts
    en el siguiente orden:
-->

<!-- 1. MÓDULOS CORE (obligatorios) -->
<script src="{% static 'js/nutricion/core/utils.js' %}"></script>
<script src="{% static 'js/nutricion/core/modal-manager.js' %}"></script>  
<script src="{% static 'js/nutricion/core/api-client.js' %}"></script>

<!-- 2. INICIALIZADOR PRINCIPAL (obligatorio) -->
<script src="{% static 'js/nutricion/main.js' %}"></script>

<!-- 3. MÓDULOS ESPECÍFICOS (según la página) -->

<!-- Para páginas de menús avanzados -->
<script src="{% static 'js/nutricion/menus_avanzado.js' %}"></script>

<!-- Para páginas de preparaciones -->
<script src="{% static 'js/nutricion/preparaciones.js' %}"></script>

<!-- Para páginas de ingredientes -->
<script src="{% static 'js/nutricion/ingredientes.js' %}"></script>

<!-- Para páginas de alimentos -->
<script src="{% static 'js/nutricion/alimentos.js' %}"></script>

<!-- Para páginas de menús básicos -->
<script src="{% static 'js/nutricion/menus.js' %}"></script>

<!-- Para páginas de detalle de preparación -->
<script src="{% static 'js/nutricion/detalle_preparacion.js' %}"></script>

<!--
    ALTERNATIVA: CARGA AUTOMÁTICA
    
    Si solo incluyes main.js, este detectará automáticamente la página
    y cargará los módulos necesarios dinámicamente:
-->

<!-- Opción simplificada (recomendada) -->
<script src="{% static 'js/nutricion/main.js' %}"></script>

<!--
    EVENTOS DISPONIBLES
    
    El sistema emite eventos que puedes escuchar:
-->

<script>
document.addEventListener('nutricion:ready', function() {
    console.log('✅ Sistema de nutrición listo');
    
    // Aquí puedes agregar código específico de la página
    // que dependa de que el sistema esté completamente cargado
});
</script>

<!--
    CONFIGURACIÓN PERSONALIZADA
    
    Puedes personalizar el comportamiento antes de cargar main.js:
-->

<script>
// Configuración antes de cargar main.js
window.NutricionConfig = {
    debug: true,  // Activar modo debug
    autoInit: true,  // Auto-inicialización
    modules: {
        utils: true,
        modals: true,
        api: true,
        menus: true
    }
};
</script>
<script src="{% static 'js/nutricion/main.js' %}"></script>

<!--
    EJEMPLO DE USO EN PÁGINA ESPECÍFICA
-->

<script>
document.addEventListener('nutricion:ready', function() {
    // Configurar eventos específicos de la página
    
    // Ejemplo: Auto-save para formularios largos
    const textarea = document.querySelector('#descripcion');
    if (textarea) {
        textarea.setAttribute('data-autosave', 'true');
    }
    
    // Ejemplo: Validación personalizada
    const formulario = document.querySelector('#formPreparacion');
    if (formulario) {
        modalManager.configurarFormulario('modalForm', {
            onSubmit: async (e, form) => {
                e.preventDefault();
                // Lógica personalizada de guardado
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                
                try {
                    await nutricionAPI.crearPreparacion(data);
                    modalManager.cerrar('modalForm');
                    location.reload();
                } catch (error) {
                    NutricionUtils.manejarError(error, 'Guardar preparación');
                }
            }
        });
    }
});
</script>