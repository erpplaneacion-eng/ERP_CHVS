{% extends 'base.html' %}
{% load static %}

{% block title %}Modalidades por Programa - ERP CHVS{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/principal/municipio_modalidades.css' %}">
{% endblock %}

{% block content %}
<div class="modalidades-municipio-container">
    <div class="page-header">
        <div class="header-left">
            <h2><i class="fas fa-list-check"></i> Configuración de Modalidades por Programa</h2>
            <p>Configura qué modalidades están habilitadas para cada programa activo.</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-success" id="btnGuardarCambios">
                <i class="fas fa-save"></i> Guardar Cambios
            </button>
            <a href="{% url 'principal:principal_index' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver
            </a>
        </div>
    </div>

    <div class="info-banner">
        <i class="fas fa-info-circle"></i>
        <div class="info-banner-text">
            <h4>¿Qué hace esta configuración?</h4>
            <p>
                Aquí puedes configurar qué modalidades de consumo (COMPLEMENTO AM, ALMUERZO, etc.)
                están disponibles para cada programa. Solo se muestran programas activos en el sistema.
            </p>
        </div>
    </div>

    <div class="search-filter">
        <div class="search-wrapper">
            <i class="fas fa-search"></i>
            <input type="text" id="searchPrograma" placeholder="Buscar programa por nombre, contrato o municipio...">
        </div>
    </div>

    <div id="programasContainer">
        {% for programa in programas %}
        <div class="municipio-card" data-programa-id="{{ programa.id }}" data-programa-nombre="{{ programa.programa }}">
            <div class="municipio-card-header" data-programa-id="{{ programa.id }}">
                <div class="municipio-info">
                    <i class="fas fa-folder-open"></i>
                    <div class="municipio-details">
                        <h3>{{ programa.programa }}</h3>
                        <p>Contrato: {{ programa.contrato }} | Municipio: {{ programa.municipio_nombre }}</p>
                    </div>
                </div>
                <div class="municipio-stats">
                    <div class="stat-badge">
                        <span class="modalidades-activas-count">{{ programa.modalidades_activas_count }}</span> / {{ modalidades_totales }} modalidades
                    </div>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
            </div>
            <div class="municipio-card-body">
                <div class="modalidades-content">
                    <div class="modalidades-grid">
                        {% for modalidad in modalidades %}
                        <div class="modalidad-item {% if modalidad.id_modalidades in programa.modalidades_activas %}active{% endif %}"
                             data-modalidad-id="{{ modalidad.id_modalidades }}">
                            <div class="modalidad-info">
                                <div class="modalidad-icon">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <div class="modalidad-text">
                                    <h4>{{ modalidad.modalidad }}</h4>
                                    <p>Código: {{ modalidad.cod_modalidad }}</p>
                                </div>
                            </div>
                            <div class="modalidad-toggle {% if modalidad.id_modalidades in programa.modalidades_activas %}active{% endif %}"
                                 data-programa-id="{{ programa.id }}"
                                 data-modalidad-id="{{ modalidad.id_modalidades }}">
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h3>No hay programas activos</h3>
            <p>Los programas solo aparecerán aquí cuando estén activos en el sistema.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/principal/programa_modalidades.js' %}"></script>
{% endblock %}
