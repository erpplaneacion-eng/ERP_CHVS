{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ERP CHVS{% endblock %}</title>
    <!-- CSS Base -->
    <link rel="stylesheet" href="{% static 'css/erp_style.css' %}">
     <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/components/modals.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- CSS específico por módulo -->
    {% if request.resolver_match.app_name == 'principal' %}
        <link rel="stylesheet" href="{% static 'css/modules/principal.css' %}">
    {% elif request.resolver_match.app_name == 'planeacion' %}
        <link rel="stylesheet" href="{% static 'css/modules/planeacion.css' %}">
    {% elif request.resolver_match.app_name == 'nutricion' %}
        <link rel="stylesheet" href="{% static 'css/modules/nutricion.css' %}">
    {% elif request.resolver_match.app_name == 'facturacion' %}
        <link rel="stylesheet" href="{% static 'css/modules/facturacion.css' %}">
    {% elif request.resolver_match.app_name == 'ocr_validation' %}
        <link rel="stylesheet" href="{% static 'css/modules/ocr_validation.css' %}">
    {% endif %}

    {% block extra_css %}{% endblock %}
</head>
<body>

    <div class="main-container">

        <!-- ========================================================== -->
        <!-- Barra Lateral Izquierda (Sidebar)                          -->
        <!-- ========================================================== -->
        <aside class="sidebar">
            <h3>Módulos del ERP</h3>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="{% url 'dashboard:dashboard' %}" class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                        <i class="fas fa-tachometer-alt"></i><span>Dashboard</span>
                    </a></li>
                    <li><a href="{% url 'principal:principal_index' %}" class="{% if request.resolver_match.url_name == 'principal_index' %}active{% endif %}">
                        <i class="fas fa-cog"></i><span>Configuración</span>
                    </a></li>
                    <li><a href="{% url 'nutricion:nutricion_index' %}" class="{% if request.resolver_match.url_name == 'nutricion_index' %}active{% endif %}">
                        <i class="fas fa-apple-alt"></i><span>Nutrición</span>
                    </a></li>
                    <li><a href="{% url 'planeacion:planeacion_index' %}" class="{% if request.resolver_match.url_name == 'planeacion_index' %}active{% endif %}">
                        <i class="fas fa-calendar-alt"></i><span>Planeación</span>
                    </a></li>
                    <li><a href="{% url 'facturacion:facturacion_index' %}" class="{% if request.resolver_match.url_name == 'facturacion_index' %}active{% endif %}">
                        <i class="fas fa-file-invoice-dollar"></i><span>Facturación</span>
                    </a></li>
                </ul>
            </nav>
            <!-- La sección user-info se ha movido al header -->
        </aside>

        <!-- ========================================================== -->
        <!-- Contenedor Principal (Derecha)                             -->
        <!-- ========================================================== -->
        <div class="content-wrapper" style="width: 100%; display: flex; flex-direction: column;">
            
            <!-- ========================================================== -->
            <!-- Cabecera Superior (Header)                                 -->
            <!-- ========================================================== -->
            <header class="header">
                <div class="header-left">
                    <button id="sidebar-toggle" class="sidebar-toggle-btn" title="Expandir/Colapsar menú">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 class="header-title">CHVS ERP System</h2>
                </div>
                <div class="header-user">
                    <span>Usuario: <strong>{{ user.username }}</strong></span>
                    <form class="logout-form" method="post" action="{% url 'logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="logout-link">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Cerrar Sesión</span>
                        </button>
                    </form>
                </div>
            </header>
        
            <main class="content-area">
                {% block content %}
                    
                {% endblock %}
            </main>
        </div>

    </div>
    <!-- ========================================================== -->
    <!-- CARGA DE ARCHIVOS JAVASCRIPT GLOBALES                      -->
    <!-- ========================================================== -->
    <!-- Archivos JS comunes -->
    <script src="{% static 'js/common/utils.js' %}"></script>
    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <!-- Archivo principal del sitio -->
    <script src="{% static 'js/principal/main.js' %}"></script>
    
    <!-- Archivos específicos según módulo y página -->
    {% if request.resolver_match.app_name == 'dashboard' or request.path == '/' %}
        <script src="{% static 'js/dashboard/dashboard.js' %}"></script>
    {% elif request.resolver_match.app_name == 'principal' %}
        {% if 'departamentos' in request.path or request.resolver_match.url_name == 'lista_departamentos' %}
            <script src="{% static 'js/principal/departamentos.js' %}"></script>
        {% elif 'municipios' in request.path or request.resolver_match.url_name == 'lista_municipios' %}
            <script src="{% static 'js/principal/municipios.js' %}"></script>
        {% elif 'instituciones' in request.path or request.resolver_match.url_name == 'lista_instituciones' %}
            <script src="{% static 'js/principal/instituciones.js' %}"></script>
        {% elif 'sedes' in request.path or request.resolver_match.url_name == 'lista_sedes' %}
            <script src="{% static 'js/principal/sedes.js' %}"></script>
        {% elif 'tipos-documento' in request.path or request.resolver_match.url_name == 'lista_tipos_documento' %}
            <script src="{% static 'js/principal/tipos_documento.js' %}"></script>
        {% elif 'tipos-genero' in request.path or request.resolver_match.url_name == 'lista_tipos_genero' %}
            <script src="{% static 'js/principal/tipos_genero.js' %}"></script>
        {% elif 'modalidades-consumo' in request.path or request.resolver_match.url_name == 'lista_modalidades_consumo' %}
            <script src="{% static 'js/principal/modalidades_consumo.js' %}"></script>
        {% elif 'niveles-grado' in request.path or request.resolver_match.url_name == 'lista_niveles_grado' %}
            <script src="{% static 'js/principal/niveles_grado.js' %}"></script>
        {% endif %}
    {% elif request.resolver_match.app_name == 'nutricion' %}
        {% if 'alimentos' in request.path %}
            <script src="{% static 'js/nutricion/alimentos.js' %}"></script>
        {% else %}
            <script src="{% static 'js/nutricion/beneficiarios.js' %}"></script>
        {% endif %}
    {% elif request.resolver_match.app_name == 'planeacion' %}
        {% if 'programas' in request.path %}
            <script src="{% static 'js/planeacion/programas.js' %}"></script>
        {% elif 'ciclos-menus' in request.path %}
            <script src="{% static 'js/planeacion/ciclos_menus.js' %}"></script>
        {% endif %}
    {% elif request.resolver_match.app_name == 'facturacion' %}
        <script src="{% static 'js/facturacion/facturacion.js' %}"></script>
    {% elif request.resolver_match.app_name == 'ocr_validation' %}
        <script src="{% static 'js/ocr_validation/ocr_processor.js' %}"></script>
    {% endif %}

    <!-- Scripts adicionales por página -->
    {% block scripts %}{% endblock %}
    {% block extra_js %}{% endblock %}
</body>
</html>