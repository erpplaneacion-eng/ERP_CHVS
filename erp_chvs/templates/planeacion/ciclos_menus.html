{% extends 'base.html' %}
{% load static %}

{% block title %}Planificar Raciones por Sede{% endblock %}

{% block content %}
<div class="planeacion-container">
    <h1>Planificar Raciones por Sede</h1>
    <p>Gestiona las cantidades de raciones por sede educativa, focalización y nivel escolar.</p>

    <!-- Filtros -->
    <div class="filters-container">
        <div class="filter-group">
            <div class="filter-field">
                <label for="filter-programa">Programa</label>
                <select id="filter-programa" name="programa" required>
                    <option value="">Seleccione un programa...</option>
                    {% for programa in programas %}
                        <option value="{{ programa.id }}" data-municipio="{{ programa.municipio.nombre_municipio }}">
                            {{ programa.programa }} - {{ programa.municipio.nombre_municipio }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="filter-field">
                <label for="municipio-auto">Municipio</label>
                <input type="text" id="municipio-auto" class="form-control" readonly placeholder="Se seleccionará automáticamente">
            </div>

            <div class="filter-field">
                <label for="filter-focalizacion">Focalización</label> {# ID ajustado #}
                <select id="filter-focalizacion" name="focalizacion" required>
                    <option value="">Seleccione...</option>
                    {% for foc in focalizaciones %}
                        <option value="{{ foc }}">{{ foc }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="filter-field">
                <label for="filter-ano">Año</label> {# ID ajustado #}
                <input type="number" id="filter-ano" name="ano" value="2025" min="2020" max="2030" required>
            </div>

            <div class="filter-field">
                <button id="btn-buscar" class="btn-primary">
                    <i class="fas fa-search"></i> Buscar
                </button>
            </div>

            <div class="filter-field">
                <button id="btn-inicializar" class="btn-success"> {# ID ajustado #}
                    <i class="fas fa-sync-alt"></i> Inicializar desde Listados
                </button>
            </div>
        </div>
    </div>

    <!-- Mensajes -->
    <div id="message-container"></div>

    <!-- Resultados -->
    <div id="results-container" class="results-container">
        <div class="no-data">
            <i class="fas fa-info-circle"></i>
            <p>Seleccione Programa y Focalización para ver los datos de planificación.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Configuración global
    window.CICLOS_MENUS_CONFIG = {
        urlInicializar: "{% url 'planeacion:inicializar_ciclos_menus' %}",
        urlActualizar: "{% url 'planeacion:actualizar_racion' %}",
        urlObtener: "{% url 'planeacion:obtener_datos_ciclos' %}",
        csrfToken: "{{ csrf_token }}"
    };

    // Manejo de selección automática de municipio
    document.addEventListener('DOMContentLoaded', function() {
        const programaSelect = document.getElementById('filter-programa');
        const municipioAutoInput = document.getElementById('municipio-auto');

        if (programaSelect && municipioAutoInput) {
            programaSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const municipio = selectedOption.getAttribute('data-municipio');
                
                if (municipio) {
                    municipioAutoInput.value = municipio;
                } else {
                    municipioAutoInput.value = '';
                }
            });
        }
    });
</script>
{% endblock %}
