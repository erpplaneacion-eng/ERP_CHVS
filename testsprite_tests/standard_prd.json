{
  "meta": {
    "project": "ERP_CHVS",
    "date": "2026-02-21",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "ERP_CHVS es un sistema ERP para operadores del PAE que centraliza la focalización de beneficiarios, el diseño y validación nutricional de menús, y la planeación operativa con reportes auditables. Proporciona herramientas para procesar listados Excel, validar normativas nutricionales y generar entregables oficiales (PDF/Excel).",
  "core_goals": [
    "Automatizar la ingestión, normalización y persistencia de listados de beneficiarios (focalización) para reducir errores humanos.",
    "Calcular y validar aportes nutricionales de menús frente a la TCAC ICBF 2018 y la Resolución UAPA, con semaforización y exportes firmados.",
    "Soportar la planeación de menús y el cálculo de necesidades de compra por sede/fecha/modalidad, integrando equivalencias ICBF→Compras.",
    "Proveer APIs y dashboard para consultar catálogos maestros (departamentos, municipios), menús e ingredientes con control de acceso por rol.",
    "Generar reportes auditables (PDF/Excel) y sincronizar datos con Google Sheets para operaciones multi-sede (Cali / Yumbo)."
  ],
  "features": [
    {
      "name": "Focalización (Facturacion API)",
      "description": "Carga, validación y procesamiento de listados de beneficiarios desde archivos Excel (SIMAT), con normalización, fuzzy matching de sedes y vista previa antes de persistir.",
      "user_flows": [
        "POST /api/auth/login with valid credentials -> Receive 200 with session cookie and CSRF token -> GET /facturacion/ with session cookie -> Receive 200 HTML dashboard -> POST /facturacion/procesar-listados/ with archivo=SIMAT_Lote3.xlsx and CSRF token -> Receive 200 HTML result containing preview, validation summary and fuzzy match suggestions -> POST /facturacion/procesar-listados/?confirm=true with CSRF token and confirmation payload -> Receive 200 HTML indicating records persisted successfully",
        "POST /api/auth/login with invalid credentials -> Receive 401 Unauthorized -> POST /facturacion/procesar-listados/ without valid auth/session -> Receive 403 Forbidden -> POST /facturacion/procesar-listados/ with archivo=corrupted_format.xlsx and valid auth -> Receive 400 with validation errors listing missing/incorrect columns and row-level error details"
      ]
    },
    {
      "name": "Catálogos maestros (Principal API)",
      "description": "APIs para consultar catálogos básicos del sistema: departamentos y municipios, usados por la focalización y la planeación.",
      "user_flows": [
        "POST /api/auth/login with valid credentials -> Receive 200 with JWT token -> GET /principal/api/departamentos/ with Authorization header -> Receive 200 JSON list of departments -> GET /principal/api/municipios/?departamento_id=DEPARTAMENTO_ID with Authorization header -> Receive 200 JSON list of municipalities filtered by departamento_id",
        "GET /principal/api/departamentos/ without Authorization header -> Receive 403 Forbidden (or 401 Unauthorized) -> POST /api/auth/login with expired credentials -> Receive 401 Unauthorized -> GET /principal/api/municipios/?departamento_id=invalid with Authorization header -> Receive 400 Bad Request explaining invalid departamento_id"
      ]
    },
    {
      "name": "Nutrición API",
      "description": "Consultas de menús e ingredientes para soportar cálculo nutricional, generación de informes y editor de menús (base para validaciones y exportes).",
      "user_flows": [
        "POST /api/auth/login with valid credentials -> Receive 200 with JWT token -> GET /nutricion/api/menus/ with Authorization header -> Receive 200 JSON list of menus including metadata and aggregated nutrient totals -> GET /nutricion/api/ingredientes/?menu_id=MENU_ID with Authorization header -> Receive 200 JSON list of ingredients and gramajes for the specified menu",
        "GET /nutricion/api/menus/ with Authorization header of a user lacking permission view_contenido_nutricion -> Receive 403 Forbidden -> GET /nutricion/api/ingredientes/ without Authorization header -> Receive 403 Forbidden (or 401 Unauthorized)"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "backend",
    "tech_stack": [
      "Python",
      "Django",
      "PostgreSQL",
      "Pandas",
      "OpenAPI/Gemini"
    ],
    "features": [
      {
        "name": "Facturacion API",
        "description": "CRUD and processing of beneficiaries list",
        "endpoints": [
          {
            "method": "GET",
            "path": "/facturacion/",
            "description": "Dashboard principal",
            "auth_required": true,
            "response_schema": {
              "200": "HTML page"
            }
          },
          {
            "method": "POST",
            "path": "/facturacion/procesar-listados/",
            "description": "Procesar listados Excel",
            "auth_required": true,
            "request_schema": {
              "body": {
                "archivo": "file"
              }
            },
            "response_schema": {
              "200": "HTML result"
            }
          }
        ]
      },
      {
        "name": "Principal API",
        "description": "Core entities like departments and municipalities",
        "endpoints": [
          {
            "method": "GET",
            "path": "/principal/api/departamentos/",
            "description": "List all departments",
            "auth_required": true
          },
          {
            "method": "GET",
            "path": "/principal/api/municipios/",
            "description": "List all municipalities",
            "auth_required": true
          }
        ]
      },
      {
        "name": "Nutricion API",
        "description": "Nutrition API for menus and ingredients",
        "endpoints": [
          {
            "method": "GET",
            "path": "/nutricion/api/menus/",
            "description": "List all menus",
            "auth_required": true
          },
          {
            "method": "GET",
            "path": "/nutricion/api/ingredientes/",
            "description": "List all ingredients",
            "auth_required": true
          }
        ],
        "depends_on": []
      }
    ],
    "known_limitations": []
  }
}
